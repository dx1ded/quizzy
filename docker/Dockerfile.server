# Building image
FROM node:22-alpine AS builder
WORKDIR /app

COPY ../ .

RUN npm install --workspace=@app/common --workspace=@app/server --legacy-peer-deps
RUN npm run server:build

# Serving server
FROM node:22-alpine
WORKDIR /app

# As it's a new node image we need to copy the build result from the other node image (the one that was used for building)
COPY --from=builder /app/@app/server/dist /app

EXPOSE 5000
CMD ["node", "index.js"]
